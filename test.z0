(code main
  ;; add/sub immediate
  (set l0 0)
  (assert-eq l0 0)
  (sub l0 1)
  (assert-eq l0 -1)
  (add l0 0x7FFFFFFF)
  (assert-eq l0 0x7FFFFFFE)
  (set l0 -1)
  (add l0 1)
  (assert-eq l0 0)

  ;; add/sub reg
  (set l1 13)
  (set l0 12)
  (add l0 l1)
  (assert-eq l0 25)
  (sub l0 l1)
  (sub l0 l1)
  (assert-eq l0 -1)

  ;; load unsigned
  (set l1 data-inc)
  (set l0 -1)
  (set l0 (u8 l1))
  (assert-eq l0 0x12)
  (set l0 -1)
  (set l0 (u16 l1))
  (assert-eq l0 0x3412)
  (set l0 -1)
  (set l0 (u32 l1))
  (assert-eq l0 0x78563412)
  (set l0 -1)
  (set l0 (u64 l1))
  (assert-eq l0 0x7856341278563412)

  ;; load unsigned
  (set l1 data-all-ones)
  (set l0 -1)
  (set l0 (u8 l1))
  (assert-eq l0 0xFF)
  (set l0 -1)
  (set l0 (u16 l1))
  (assert-eq l0 0xFFFF)
  (set l0 -1)
  (set l0 (u32 l1))
  (assert-eq l0 0xFFFFFFFF)
  (set l0 -1)
  (set l0 (u64 l1))
  (add l0 1)
  (assert-eq l0 0)

  ;; cmp/jne
  (set l0 12)
  (cmp l0 13)
  (jne .ok1)
  (assert-fail)
.ok1
  (set l1 13)
  (cmp l0 l1)
  (jne .ok2)
  (assert-fail)
.ok2

  ;; push/pop
  (set l1 14)
  (set l0 0)
  (push l1)
  (pop l0)
  (assert-eq l0 14)

  ;; call/ret
  (call sub-1234)
  (assert-eq l0 1234)

  ;; jmp
  (jmp .ok4)
  (assert-fail)
.ok3
  (jmp .ok5)
  (assert-fail)
.ok4
  (jmp .ok3)
  (assert-fail)
.ok5

  ;; PASS
  (set l4 0)
  (set l0 60)
  (syscall))

(code sub-1234
  (set l0 1234)
  (ret))

(code data-inc
  (1 0x12 0x34 0x56 0x78 0x12 0x34 0x56 0x78))

(code data-all-ones
  (1 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF))
